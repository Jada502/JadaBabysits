<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nice Babysiters ‚ú®üê∞</title>
  <style>
    :root{
      --bg:#fff1f6;
      --pink:#d14f8f;
      --soft:#ffd6ea;
      --card:#fff;
      --accent:#ff9ac9;
      --muted:#8f5a78;
    }
    html,body{height:100%;margin:0;font-family: "Poppins", "Comic Sans MS", system-ui, sans-serif;background:var(--bg); color:var(--pink);}
    .container{max-width:980px;margin:18px auto;padding:12px;}
    header{display:flex;align-items:center;gap:14px;flex-wrap:wrap;justify-content:center}
    img.logo{width:120px;height:auto;border-radius:18px;box-shadow:0 6px 18px rgba(209,79,143,0.12);border:3px solid rgba(255,154,201,0.2)}
    h1{margin:0;font-size:1.6rem}
    .subtitle{color:var(--muted);font-size:0.95rem;margin-top:4px}
    nav{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin:16px 0}
    nav button{background:var(--card);border:2px solid var(--accent);padding:10px 12px;border-radius:12px;cursor:pointer;color:var(--pink);font-weight:600}
    nav button.active{background:var(--accent);color:white}
    .card{background:var(--card);border-radius:16px;padding:16px;border:2px solid rgba(255,154,201,0.35);box-shadow:0 4px 10px rgba(0,0,0,0.05);max-width:840px;margin:12px auto;}
    .grid{display:grid;gap:12px}
    .two{grid-template-columns:1fr 1fr}
    ul.clean{padding-left:1rem;margin:0}
    .muted{color:var(--muted)}
    .btn{background:var(--pink);color:white;padding:10px 14px;border-radius:12px;border:none;cursor:pointer;font-weight:700}
    .small{font-size:0.9rem}
    input,select,textarea{padding:10px;border-radius:10px;border:2px solid #ffd9ea; width:100%; box-sizing:border-box}
    .center{text-align:center}
    .punch-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;max-width:260px;margin:12px auto}
    .punch{width:44px;height:44px;border-radius:10px;border:2px solid #ffd4e8;display:flex;align-items:center;justify-content:center;font-size:1.1rem}
    .punch.filled{background:var(--pink);color:white;border-color:var(--pink)}
    .note{font-size:0.85rem;color:var(--muted)}
    .booking-item{border-radius:12px;padding:10px;border:1px dashed #ffd6ea;background:linear-gradient(180deg,#fff,#fff);margin-bottom:8px}
    .top-row{display:flex;gap:12px;align-items:center;justify-content:space-between}
    footer{margin-top:24px;text-align:center;color:var(--muted);font-size:0.85rem}
    .small-link{background:none;border:none;color:var(--pink);text-decoration:underline;cursor:pointer;padding:0}
    .delete-btn{background:#ff6b6b;color:white;border:none;padding:6px 8px;border-radius:10px;cursor:pointer}
    .staff-controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    @media(max-width:520px){
      .two{grid-template-columns:1fr}
      img.logo{width:96px}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img class="logo" src="Bunny%20love%20for%20Jada%20Babysite.png" alt="Jada Babysits Logo" onerror="this.style.display='none'"/>
      <div>
        <h1>‚ú® Nice Babysiters ‚ú®</h1>
        <div class="subtitle">Friendly ‚Ä¢ Safe ‚Ä¢ Fun babysitting in San Ramon üíï</div>
      </div>
    </header>

    <nav id="mainNav">
      <button onclick="navTo('home')" id="nav-home">üè† Home</button>
      <button onclick="navTo('booking')" id="nav-booking">üìÜ Booking</button>
      <button onclick="navTo('calendar')" id="nav-calendar">üìÖ Calendar</button>
      <button onclick="navTo('punch')" id="nav-punch">üéü Punch Card</button>
      <button onclick="navTo('about')" id="nav-about">üíñ About</button>
      <button onclick="navTo('rates')" id="nav-rates">üíµ Rates</button>
      <button onclick="navTo('contact')" id="nav-contact">üìû Contact</button>
      <button onclick="navTo('account')" id="nav-account">üë§ Account</button>
      <button onclick="navTo('parents')" id="nav-parents">üîí Parents Only</button>
    </nav>

    <!-- HOME -->
    <section id="home" class="card">
      <div class="top-row">
        <div>
          <h2>Welcome!</h2>
          <div class="muted">Hi ‚Äî I'm Jada. I love crafts, games, and keeping kids safe while parents are away.</div>
        </div>
        <div class="center">
          <div class="note">Bookings so far</div>
          <div style="font-size:1.6rem;font-weight:700" id="totalBookings">0</div>
        </div>
      </div>
    </section>

    <!-- BOOKING (Calendar Booking Page) -->
    <section id="booking" class="card" style="display:none">
      <h2>Request Booking</h2>
      <div id="bookingArea">
        <div id="bookingNotice" class="note">You must be logged in as a parent to request a booking.</div>
        <div style="margin-top:10px">
          <label>Parent name</label>
          <input id="bf_parent" type="text" placeholder="Your name" />
          <label style="margin-top:8px">Child's name</label>
          <input id="bf_child" type="text" placeholder="Kid's name" />
          <label style="margin-top:8px">Date</label>
          <input id="bf_date" type="date" />
          <label style="margin-top:8px">Time</label>
          <input id="bf_time" type="time" />
          <label style="margin-top:8px">Notes</label>
          <textarea id="bf_notes" rows="3" placeholder="Allergies, bedtime, etc."></textarea>
          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn" onclick="submitBooking()">Send Booking</button>
            <div class="note" style="align-self:center">Bookings are saved locally for demo</div>
          </div>
        </div>
      </div>

      <hr style="margin:14px 0" />
      <h3>Your bookings</h3>
      <div id="bookingList"></div>
    </section>

    <!-- CALENDAR -->
    <section id="calendar" class="card" style="display:none">
      <h2>Calendar (Booked Dates)</h2>
      <div id="calendarList" class="muted small"></div>
    </section>

    <!-- PUNCH CARD -->
    <section id="punch" class="card" style="display:none">
      <h2>Punch Card</h2>
      <div class="muted">Earn 1 punch per confirmed booking. Collect 10 for a reward!</div>
      <div style="text-align:center;margin-top:12px;">
        <div id="punchCount" style="font-weight:700;font-size:1.5rem">0</div>
        <div class="note">punches so far</div>
      </div>
      <div class="punch-grid" style="margin-top:12px" id="punchGrid"></div>
      <div class="note" style="margin-top:10px" id="punchNote"></div>
    </section>

    <!-- ABOUT -->
    <section id="about" class="card" style="display:none">
      <h2>About Me</h2>
      <p class="muted">I'm Jada ‚Äî a responsible babysitter from San Ramon who loves creating fun activities and keeping kids safe.</p>
    </section>

    <!-- RATES -->
    <section id="rates" class="card" style="display:none">
      <h2>Rates</h2>
      <ul class="clean small">
        <li>After school ‚Äî <strong>$10/hr</strong></li>
        <li>Evenings ‚Äî <strong>$12/hr</strong></li>
        <li>Weekends ‚Äî <strong>$15/hr</strong></li>
      </ul>
    </section>

    <!-- CONTACT -->
    <section id="contact" class="card" style="display:none">
      <h2>Contact</h2>
      <p>Parents can reach me at:</p>
      <p>üìß <strong>jada-babysits@example.com</strong></p>
      <p>üìç San Ramon</p>
    </section>

    <!-- ACCOUNT (Sign up / Login) -->
    <section id="account" class="card" style="display:none">
      <h2>Account</h2>
      <div id="accountArea">
        <div id="accountInfo" style="margin-bottom:10px"></div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" onclick="showSignup()">Sign Up</button>
          <button class="btn" onclick="showLogin()">Log In</button>
          <button style="background:#fff;border:2px solid var(--accent);color:var(--pink);border-radius:10px;padding:10px 12px" onclick="logout()">Log Out</button>
        </div>
        <div id="authForms" style="margin-top:12px"></div>
        <div class="note" style="margin-top:8px">This is a demo fake-login stored only in your browser (no passwords are sent anywhere).</div>
      </div>
    </section>

    <!-- PARENTS-ONLY -->
    <section id="parents" class="card" style="display:none">
      <h2>üîí Parents Only</h2>
      <div class="note">This page is only for accounts signed up as a Parent. Sign up and check the "I am a parent" box.</div>
      <div id="parentsContent" style="margin-top:10px"></div>
    </section>

    <footer class="muted">Made with üíñ for Jada | Demo site (localStorage)</footer>
  </div>

  <script>
    // --- localStorage keys ---
    const LS_ACCOUNTS = 'jada_accounts_v3';
    const LS_USER = 'jada_user_v3';
    const LS_BOOKINGS = 'jada_bookings_v3';
    const LS_PUNCH = 'jada_punches_v1';

    // secret staff code (babysitter/staff must enter this at signup to become staff)
    const STAFF_CODE = 'BBS-9274';

    // --- helpers to read/write localStorage ---
    function save(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
    function load(k){ try{ return JSON.parse(localStorage.getItem(k)) || null }catch(e){return null} }

    // initial state
    let accounts = load(LS_ACCOUNTS) || [];
    let user = load(LS_USER) || null;
    let bookings = load(LS_BOOKINGS) || [];
    let punches = load(LS_PUNCH) || {}; // { parentName: number }

    // seed a sample staff account (Jada) if no accounts exist
    if(accounts.length === 0){
      accounts.push({ name: 'Jada', pass: 'jada123', isParent: false, isStaff: true });
      // place-holder example friends - you can create real staff via sign-up+code too
      accounts.push({ name: 'Friend1', pass: 'f1pass', isParent: false, isStaff: true });
      accounts.push({ name: 'Friend2', pass: 'f2pass', isParent: false, isStaff: true });
      save(LS_ACCOUNTS, accounts);
    }

    // navigation helper
    function navTo(id){
      const sections = ['home','booking','calendar','punch','about','rates','contact','account','parents'];
      sections.forEach(s => document.getElementById(s).style.display = (s===id ? 'block' : 'none'));
      // update active nav style
      sections.forEach(s => {
        const el = document.getElementById('nav-'+s);
        if(el && el.classList) el.classList.remove('active');
      });
      const activeEl = document.getElementById('nav-'+id);
      if(activeEl) activeEl.classList.add('active');
      // render dynamic content
      if(id==='account') renderAccount();
      if(id==='booking') renderBookingList();
      if(id==='calendar') renderCalendar();
      if(id==='punch') renderPunch();
      if(id==='parents') renderParents();
      updateTotals();
    }

    // update total bookings shown on home
    function updateTotals(){ document.getElementById('totalBookings').innerText = bookings.length; }

    // ------------ ACCOUNT UI & AUTH ------------
    function renderAccount(){
      const ai = document.getElementById('accountInfo');
      const af = document.getElementById('authForms');
      af.innerHTML = '';
      if(user){
        ai.innerHTML = `<div class="muted">Logged in as <strong>${escapeHtml(user.name)}</strong> ${user.isParent ? 'üë®‚Äçüë©‚Äçüëß' : ''}${user.isStaff ? ' üõ°Ô∏è Staff' : ''}</div>`;
        document.getElementById('bf_parent').value = user.name;
      } else {
        ai.innerHTML = `<div class="muted">Not logged in</div>`;
      }
    }

    function showSignup(){
      const af = document.getElementById('authForms');
      af.innerHTML = `
        <div style="margin-top:8px">
          <label>Account name</label>
          <input id="su_name" placeholder="Your name" />
          <label style="margin-top:8px">Create password</label>
          <input id="su_pass" type="password" placeholder="Password" />
          <label style="margin-top:8px"><input id="su_isparent" type="checkbox" /> I'm a parent</label>
          <label style="margin-top:8px"><input id="su_isstaff" type="checkbox" /> I'm staff (requires code)</label>
          <div id="su_staff_code_wrap" style="display:none;margin-top:8px">
            <label>Staff code</label>
            <input id="su_staff_code" placeholder="Enter staff code" />
          </div>
          <div style="margin-top:8px"><button class="btn" onclick="signup()">Create Account</button></div>
        </div>
      `;
      // show staff code input when checkbox toggled
      const cb = document.getElementById('su_isstaff');
      cb.addEventListener('change', ()=> {
        document.getElementById('su_staff_code_wrap').style.display = cb.checked ? 'block' : 'none';
      });
    }

    function showLogin(){
      const af = document.getElementById('authForms');
      af.innerHTML = `
        <div style="margin-top:8px">
          <label>Name</label>
          <input id="li_name" placeholder="Your name" />
          <label style="margin-top:8px">Password</label>
          <input id="li_pass" type="password" placeholder="Password" />
          <div style="margin-top:8px"><button class="btn" onclick="login()">Log In</button></div>
        </div>
      `;
    }

    function signup(){
      const n = (document.getElementById('su_name')||{}).value.trim() || '';
      const p = (document.getElementById('su_pass')||{}).value || '';
      const isParent = !!(document.getElementById('su_isparent')||{}).checked;
      const wantsStaff = !!(document.getElementById('su_isstaff')||{}).checked;
      const staffCode = (document.getElementById('su_staff_code')||{}).value || '';
      if(!n || !p){ alert('Please enter name & password'); return; }
      if(accounts.find(a=>a.name===n)){ alert('That name already exists. Choose another.'); return; }
      let isStaff = false;
      if(wantsStaff){
        if(staffCode === STAFF_CODE){
          isStaff = true;
        } else {
          alert('Invalid staff code. You will not be registered as staff.');
        }
      }
      const a = { name:n, pass:p, isParent: !!isParent, isStaff: !!isStaff };
      accounts.push(a); save(LS_ACCOUNTS, accounts);
      user = { name:n, isParent: !!isParent, isStaff: !!isStaff }; save(LS_USER, user);
      renderAccount(); alert('Account created & logged in! üòä'); navTo('home');
    }

    function login(){
      const n = (document.getElementById('li_name')||{}).value || '';
      const p = (document.getElementById('li_pass')||{}).value || '';
      const f = accounts.find(a=>a.name===n && a.pass===p);
      if(!f){ alert('Login failed. Check name/password.'); return; }
      user = { name:f.name, isParent: !!f.isParent, isStaff: !!f.isStaff }; save(LS_USER, user);
      renderAccount(); alert('Welcome back! üíñ'); navTo('home');
    }

    function logout(){ user = null; save(LS_USER, null); renderAccount(); alert('Logged out'); navTo('home'); }

    // ------------ BOOKINGS ------------
    function submitBooking(){
      if(!user || !user.isParent){ alert('Please sign up or log in as a parent to book.'); navTo('account'); return; }
      const parent = (document.getElementById('bf_parent')||{}).value.trim();
      const child = (document.getElementById('bf_child')||{}).value.trim();
      const date = (document.getElementById('bf_date')||{}).value;
      const time = (document.getElementById('bf_time')||{}).value;
      const notes = (document.getElementById('bf_notes')||{}).value.trim();
      if(!parent || !child || !date || !time){ alert('Please fill name, child, date and time'); return; }
      const newBooking = { parent, child, date, time, notes, by:user.name, created: new Date().toISOString() };
      bookings.push(newBooking);
      save(LS_BOOKINGS, bookings);
      // increment punch for this parent
      punches[parent] = (punches[parent] || 0) + 1;
      save(LS_PUNCH, punches);
      renderBookingList(); renderCalendar(); renderPunch(); updateTotals();
      alert('Booking submitted! (Saved to your browser.)');
      // clear inputs
      (document.getElementById('bf_child')||{}).value=''; (document.getElementById('bf_date')||{}).value=''; (document.getElementById('bf_time')||{}).value=''; (document.getElementById('bf_notes')||{}).value='';
    }

    function deleteBooking(index){
      if(!user || !user.isStaff){ alert('Only staff can delete bookings.'); return; }
      // remove booking and adjust punch
      const removed = bookings.splice(index,1)[0];
      if(removed && removed.parent){
        punches[removed.parent] = Math.max(0, (punches[removed.parent]||0) - 1);
        save(LS_PUNCH, punches);
      }
      save(LS_BOOKINGS, bookings);
      renderBookingList(); renderCalendar(); renderPunch(); updateTotals();
      alert('Booking deleted.');
    }

    function renderBookingList(){
      const el = document.getElementById('bookingList'); el.innerHTML = '';
      // show all bookings to staff, otherwise only user's bookings
      const list = (user && user.isStaff) ? bookings : bookings.filter(b => !user || b.by === user.name);
      if(list.length===0){ el.innerHTML = '<div class="muted">No bookings yet</div>'; return; }
      list.forEach((b, idx) => {
        const d = document.createElement('div'); d.className='booking-item';
        // when showing filtered list (non-staff) idx won't equal bookings index; we need original index for delete
        const originalIndex = bookings.indexOf(b);
        d.innerHTML = `<div style="font-weight:700">${escapeHtml(b.child)} ‚Äî <span class="muted small">${escapeHtml(b.date)} ${escapeHtml(b.time)}</span></div>
                       <div class="muted">Parent: ${escapeHtml(b.parent)}</div>
                       <div style="margin-top:6px;font-size:0.9rem">${escapeHtml(b.notes||'')}</div>`;
        if(user && user.isStaff){
          const btn = document.createElement('button');
          btn.className = 'delete-btn';
          btn.innerText = 'Delete';
          btn.onclick = () => {
            if(confirm('Delete this booking?')) deleteBooking(originalIndex);
          };
          d.appendChild(btn);
        }
        el.appendChild(d);
      });
    }

    // ------------ CALENDAR ------------
    function renderCalendar(){
      const el = document.getElementById('calendarList'); el.innerHTML = '';
      const dates = [...new Set(bookings.map(b=>b.date))].sort();
      if(dates.length===0){ el.innerHTML = '<div class="muted">No dates booked yet</div>'; return; }
      dates.forEach(d=>{
        const count = bookings.filter(b=>b.date===d).length;
        const row = document.createElement('div'); row.style.marginBottom='6px';
        row.innerHTML = `<strong>${d}</strong> ‚Äî ${count} booking(s)`;
        el.appendChild(row);
      });
    }

    // ------------ PUNCH CARD ------------
    function renderPunch(){
      const grid = document.getElementById('punchGrid'); grid.innerHTML = '';
      // show global count for logged-in user (their punches) or total if staff
      const count = (user && !user.isStaff) ? (punches[user.name] || 0) : Object.values(punches).reduce((a,b)=>a+b,0);
      document.getElementById('punchCount').innerText = count;
      const filled = (user && !user.isStaff) ? (punches[user.name] || 0) % 10 : 0;
      // if user is staff show aggregated or per-parent cards instead below
      if(user && user.isStaff){
        // staff sees per-parent mini cards below the main area
        document.getElementById('punchNote').innerText = 'You can manage punches for each parent below.';
      } else {
        for(let i=0;i<10;i++){
          const box = document.createElement('div'); box.className='punch' + (i<filled ? ' filled' : '');
          box.innerHTML = i<filled ? '‚ù§' : '‚ô°';
          grid.appendChild(box);
        }
        const note = document.getElementById('punchNote');
        if(filled===0) note.innerText = 'Start earning punches by booking sessions!';
        else if(filled<10) note.innerText = `${10-filled} punches until a reward üéÅ`;
        else note.innerText = 'You earned a reward! Claim with Jada üíñ';
      }
      // if staff show per-parent punch cards under a section in the parents page (renderParents handles it)
    }

    // ------------ PARENTS-ONLY PAGE ------------
    function renderParents(){
      const el = document.getElementById('parentsContent'); el.innerHTML = '';
      if(!user || !user.isParent){
        // if staff, allow staff view
        if(user && user.isStaff){
          const h = document.createElement('div'); h.innerHTML = `<div style="font-weight:700">Staff dashboard ‚Äî All parents & punches</div>`;
          el.appendChild(h);
        } else {
          el.innerHTML = '<div class="muted">This page is for parents only. Please sign up and check the "I am a parent" box.</div>';
          return;
        }
      }

      // If staff: show all parents and controls
      if(user && user.isStaff){
        const parents = Array.from(new Set(bookings.map(b => b.parent).concat(Object.keys(punches))));
        if(parents.length === 0) {
          const p = document.createElement('div'); p.className='muted'; p.innerText = 'No parent data yet'; el.appendChild(p);
        } else {
          parents.forEach(parent => {
            const wrap = document.createElement('div'); wrap.className='booking-item';
            const count = punches[parent] || 0;
            wrap.innerHTML = `<div style="font-weight:700">${escapeHtml(parent)}</div>
                              <div class="muted">Punches: <strong>${count}</strong></div>`;
            // staff controls: add punch / reset
            const controls = document.createElement('div'); controls.className='staff-controls';
            const add = document.createElement('button'); add.className='btn'; add.innerText = '+ Punch';
            add.onclick = ()=> { punches[parent] = (punches[parent]||0)+1; save(LS_PUNCH,punches); renderParents(); renderPunch(); };
            const reset = document.createElement('button'); reset.className='btn'; reset.innerText='Reset';
            reset.onclick = ()=> { if(confirm('Reset punches for '+parent+'?')){ punches[parent]=0; save(LS_PUNCH,punches); renderParents(); renderPunch(); } };
            controls.appendChild(add); controls.appendChild(reset);
            wrap.appendChild(controls);
            // list parent's bookings
            const parentBookings = bookings.filter(b=>b.parent===parent);
            if(parentBookings.length>0){
              const sub = document.createElement('div'); sub.style.marginTop='8px';
              parentBookings.forEach(pb => {
                const item = document.createElement('div'); item.className='booking-item';
                item.innerHTML = `<div style="font-weight:700">${escapeHtml(pb.child)} ‚Äî <span class="muted small">${escapeHtml(pb.date)} ${escapeHtml(pb.time)}</span></div>
                                  <div class="muted">Notes: ${escapeHtml(pb.notes||'')}</div>`;
                sub.appendChild(item);
              });
              wrap.appendChild(sub);
            }
            el.appendChild(wrap);
          });
        }
        // staff export all bookings button
        const btn = document.createElement('button'); btn.className='btn'; btn.style.marginTop='10px';
        btn.innerText = 'Export all bookings (CSV)';
        btn.onclick = ()=>{ downloadCSV(bookings); };
        el.appendChild(btn);
        return;
      }

      // For parent users: show their data only
      const my = bookings.filter(b => b.parent === user.name);
      const header = document.createElement('div'); header.innerHTML = `<div style="font-weight:700">Bookings for ${escapeHtml(user.name)}</div>`;
      el.appendChild(header);
      if(my.length===0){ const p=document.createElement('div'); p.className='muted'; p.innerText='No bookings yet'; el.appendChild(p); }
      else {
        my.forEach(b=>{
          const d = document.createElement('div'); d.className='booking-item';
          d.innerHTML = `<div style="font-weight:700">${escapeHtml(b.child)} ‚Äî <span class="muted small">${escapeHtml(b.date)} ${escapeHtml(b.time)}</span></div>
                         <div class="muted">Notes: ${escapeHtml(b.notes||'')}</div>`;
          el.appendChild(d);
        });
        const btn = document.createElement('button'); btn.className='btn'; btn.innerText = 'Export my bookings (CSV)';
        btn.onclick = ()=>{ downloadCSV(my); };
        el.appendChild(btn);
      }

      // show this parent's punch card
      const pc = document.createElement('div'); pc.style.marginTop='12px';
      const pcount = punches[user.name] || 0;
      pc.innerHTML = `<div style="font-weight:700">Your Punches: ${pcount}</div>
                      <div class="note">Collect 10 punches for a reward!</div>`;
      el.appendChild(pc);
    }

    // helper to download CSV
    function downloadCSV(list){
      const rows = [['parent','child','date','time','notes','created']];
      list.forEach(b => rows.push([b.parent,b.child,b.date,b.time,b.notes,b.created]));
      const csv = rows.map(r => r.map(c=>`"${String(c||'').replace(/"/g,'""')}"`).join(',')).join('\\n');
      const blob = new Blob([csv], {type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download = 'bookings.csv'; a.click();
      URL.revokeObjectURL(url);
    }

    // small helper escape
    function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, (m)=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]));}

    // initialize UI
    (function init(){
      document.getElementById('bf_parent').value = user && user.name ? user.name : '';
      renderAccount(); renderBookingList(); renderCalendar(); renderPunch(); updateTotals();
      navTo('home');
      // ensure punches object saved
      save(LS_PUNCH, punches);
    })();

    // make some functions global for onClick inline handlers
    window.navTo = navTo;
    window.showSignup = showSignup;
    window.showLogin = showLogin;
    window.signup = signup;
    window.login = login;
    window.logout = logout;
    window.submitBooking = submitBooking;
    window.deleteBooking = deleteBooking;
  </script>
</body>
</html>
